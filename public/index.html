<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Quickly turn Google Sheets into a public, CDN-backed JSON endpoint."
    />
    <title>sheet.spacet.me</title>
    <meta
      property="og:image"
      content="https://capture.the.spacet.me/eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmwiOiJodHRwczovL3NoZWV0LnNwYWNldC5tZS8iLCJ3aWR0aCI6NjAwLCJoZWlnaHQiOjMxNSwid2FpdFVudGlsIjoibmV0d29ya2lkbGUwIiwiZGV2aWNlU2NhbGVGYWN0b3IiOjIsImlzcyI6ImR0aW50aCJ9.MsJg-jvhui0jN86nbIHbMWOM0s0xzYB2RtWZolAmiv9fJTcl5ZMqX7OJvqLfZJR7s01Wk450y8XKWNjIH1CeLRhReE-AHJ7jpBHsT12v001cYH3Eho1SgzSXcp_VMAW-vr6sl3gKSJYYBCF4lJ9md3kwpskvZJPR78O7_oYQ1f7Bfq-zUyNJZKtd6yj3ZANa_HzONU3ZOBT5LATRz2gIdsP4BJ0x60wMcsK-bpAHJc9-YOxqjUGSiwsXjU1S6oj3BaZCdhQpoqg741VvdZWLEQ_7CK9YjUyhzCwKM4efIBhW2ueFO4kVvDuloo0AhQUHFG9b-Mv6j8XF9fW7zUt9fQ.png"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-ECSE6V6VK2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag() {
        dataLayer.push(arguments)
      }
      gtag('js', new Date())

      gtag('config', 'G-ECSE6V6VK2')
    </script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.css"
    />
    <style>
      code > strong {
        color: #379;
      }
      input.text-input {
        max-width: 100%;
        box-sizing: border-box;
        padding-right: 0;
      }
      button {
        padding-left: 1em;
        padding-right: 1em;
      }
    </style>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-ECSE6V6VK2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag() {
        dataLayer.push(arguments)
      }
      gtag('js', new Date())

      gtag('config', 'G-ECSE6V6VK2')
    </script>
  </head>
  <body>
    <h1>sheet.spacet.me</h1>
    <p>Quickly turn Google Sheets into a public, CDN-backed JSON endpoint.</p>

    <h2>Usage</h2>
    <ol>
      <li>
        Make the sheet accessible to this service by doing any of these:
        <ul>
          <li>
            Share the sheet with <code id="email">(service account email)</code>
          </li>
          <li>Make the sheet viewable by anyone with the link.</li>
        </ul>
      </li>
      <li>Use the API (see below).</li>
    </ol>

    <script>
      fetch('/api/sheet')
        .then((r) => r.json())
        .then((x) => (document.querySelector('#email').textContent = x.email))
    </script>

    <h2>API</h2>
    <ul>
      <li>
        <code
          >GET /<strong>sheetId</strong>/<strong>sheetName</strong>.json</code
        >
        &mdash; Returns the sheet data as JSON (<a
          href="/1_hCWsZ13xSnjnmSCx4flTFJCZ6D4yRZjDsaYDchqu08/Sheet1.json"
          >example</a
        >)
      </li>
    </ul>

    <h2>URL generator</h2>
    <form>
      <p>
        <label for="sheet-url">Google Sheet URL:</label>
        <input
          class="text-input"
          id="sheet-url"
          type="text"
          size="100"
          placeholder="https://docs.google.com/spreadsheets/d/1_hCWsZ13xSnjnmSCx4flTFJCZ6D4yRZjDsaYDchqu08/edit#gid=0"
        />
      </p>
      <p>
        <label for="sheet-name">Sheet name:</label>
        <input
          class="text-input"
          id="sheet-name"
          type="text"
          size="16"
          value="Sheet1"
        />
      </p>
      <p>
        <label for="endpoint-url">Endpoint URL:</label>
        <span style="display: flex; gap: 1ex">
          <span style="flex: auto">
            <input
              class="text-input"
              name="endpoint"
              style="width: 100%"
              id="endpoint-url"
              type="text"
              size="100"
              value=""
              readonly
            />
          </span>
          <span style="flex: none">
            <!-- Copy to clipboard button -->
            <button
              type="button"
              onclick="this.form.endpoint.focus(); this.form.endpoint.select(); document.execCommand('copy');"
            >
              Copy
            </button>
          </span>
        </span>
      </p>
    </form>
    <script>
      {
        const $ = (selector) => document.querySelector(selector)
        const update = () => {
          const url = $('#sheet-url').value || $('#sheet-url').placeholder
          const name = $('#sheet-name').value.trim()
          $('#endpoint-url').value = (() => {
            const match = url.match(/\/d\/([^\/]+)/)
            if (!match) {
              return '⚠️ Missing sheet URL'
            }
            if (!name) {
              return '⚠️ Missing sheet name'
            }
            const sheetNameRegex = /^[a-zA-Z0-9_-]+$/
            if (!sheetNameRegex.test(name)) {
              return '⚠️ Sheet name may only contain letters, numbers, dashes, and underscores'
            }
            const sheetId = match[1]
            const endpoint = `/${sheetId}/${name}.json`
            return location.origin + endpoint
          })()
        }
        update()
        $('#sheet-url').onchange = $('#sheet-name').onchange = update
      }
    </script>

    <h2>Usage notes</h2>
    <ul>
      <li>
        The endpoint is backed by two layers of CDN caching:
        <a
          href="https://support.cloudflare.com/hc/en-us/articles/200172516-Understanding-Cloudflare-s-CDN"
          >Cloudflare</a
        >
        and
        <a href="https://vercel.com/docs/edge-network/caching">
          Vercel Edge Network </a
        >. Due to aggressive caching strategy, the sheet contents may be delayed
        by about <strong>1 minute</strong>.
      </li>
      <li>
        I made this API mainly for my own convenience. While you are welcome to
        use it, there is no support nor uptime guarantee. But this project is
        open source, and you can run your own instance.
        <a href="https://github.com/dtinth/sheet">Source code is on GitHub.</a>
      </li>
    </ul>

    <hr />
    <p>API built by <a href="https://dt.in.th">@dtinth</a>.</p>
    <script>
      if (location.hash === '#og') {
        document.body.style.marginTop = '150px'
      }
    </script>
    <script>
      fetch('/api/random-tweet')
        .then((r) => r.json())
        .catch((e) => {
          return {
            text: `${e}`,
          }
        })
        .then((j) => {
          textEl.textContent = j.text
          if (j.user) {
            attributionEl.innerHTML = `&mdash;<a href="${j.url}">@${j.user.screen_name}</a>`
          }
        })
    </script>
  </body>
</html>
